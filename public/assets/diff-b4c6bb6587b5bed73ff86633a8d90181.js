var JsDiff=function(){function e(e){return{newPos:e.newPos,components:e.components.slice(0)}}function t(e){for(var t=[],i=0;e.length>i;i++)e[i]&&t.push(e[i]);return t}function i(e){var t=e;return t=t.replace(/&/g,"&amp;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=t.replace(/"/g,"&quot;")}var n=function(e){this.ignoreWhitespace=e};n.prototype={diff:function(t,i){if(i==t)return[{value:i}];if(!i)return[{value:t,removed:!0}];if(!t)return[{value:i,added:!0}];i=this.tokenize(i),t=this.tokenize(t);var n=i.length,s=t.length,o=n+s,r=[{newPos:-1,components:[]}],a=this.extractCommon(r[0],i,t,0);if(r[0].newPos+1>=n&&a+1>=s)return r[0].components;for(var l=1;o>=l;l++)for(var c=-1*l;l>=c;c+=2){var h,u=r[c-1],d=r[c+1];a=(d?d.newPos:0)-c,u&&(r[c-1]=void 0);var f=u&&n>u.newPos+1,p=d&&a>=0&&s>a;if(f||p){!f||p&&u.newPos<d.newPos?(h=e(d),this.pushComponent(h.components,t[a],void 0,!0)):(h=e(u),h.newPos++,this.pushComponent(h.components,i[h.newPos],!0,void 0));var a=this.extractCommon(h,i,t,c);if(h.newPos+1>=n&&a+1>=s)return h.components;r[c]=h}else r[c]=void 0}},pushComponent:function(e,t,i,n){var s=e[e.length-1];s&&s.added===i&&s.removed===n?e[e.length-1]={value:this.join(s.value,t),added:i,removed:n}:e.push({value:t,added:i,removed:n})},extractCommon:function(e,t,i,n){for(var s=t.length,o=i.length,r=e.newPos,a=r-n;s>r+1&&o>a+1&&this.equals(t[r+1],i[a+1]);)r++,a++,this.pushComponent(e.components,t[r],void 0,void 0);return e.newPos=r,a},equals:function(e,t){var i=/\S/;return!this.ignoreWhitespace||i.test(e)||i.test(t)?e==t:!0},join:function(e,t){return e+t},tokenize:function(e){return e}};var s=new n,o=new n(!0);o.tokenize=function(e){return t(e.split(/(\s+|\b)/))};var r=new n(!0);r.tokenize=function(e){return t(e.split(/([{}:;,]|\s+)/))};var a=new n;return a.tokenize=function(e){return e.split(/^/m)},{diffChars:function(e,t){return s.diff(e,t)},diffWords:function(e,t){return o.diff(e,t)},diffLines:function(e,t){return a.diff(e,t)},diffCss:function(e,t){return r.diff(e,t)},createPatch:function(e,t,i,n,s){function o(e){return e.map(function(e){return" "+e})}function r(e,t,i){var n=c[c.length-2],s=t===c.length-2,o=t===c.length-3&&(i.added===!n.added||i.removed===!n.removed);/\n$/.test(i.value)||!s&&!o||e.push("\\ No newline at end of file")}var l=[];l.push("Index: "+e),l.push("==================================================================="),l.push("--- "+e+("undefined"==typeof n?"":"	"+n)),l.push("+++ "+e+("undefined"==typeof s?"":"	"+s));var c=a.diff(t,i);c[c.length-1].value||c.pop(),c.push({value:"",lines:[]});for(var h=0,u=0,d=[],f=1,p=1,g=0;c.length>g;g++){var m=c[g],v=m.lines||m.value.replace(/\n$/,"").split("\n");if(m.lines=v,m.added||m.removed){if(!h){var _=c[g-1];h=f,u=p,_&&(d=o(_.lines.slice(-4)),h-=d.length,u-=d.length)}d.push.apply(d,v.map(function(e){return(m.added?"+":"-")+e})),r(d,g,m),m.added?p+=v.length:f+=v.length}else{if(h)if(8>=v.length&&c.length-2>g)d.push.apply(d,o(v));else{var b=Math.min(v.length,4);l.push("@@ -"+h+","+(f-h+b)+" +"+u+","+(p-u+b)+" @@"),l.push.apply(l,d),l.push.apply(l,o(v.slice(0,b))),4>=v.length&&r(l,g,m),h=0,u=0,d=[]}f+=v.length,p+=v.length}}return l.join("\n")+"\n"},convertChangesToXML:function(e){for(var t=[],n=0;e.length>n;n++){var s=e[n];s.added?t.push("<ins>"):s.removed&&t.push("<del>"),t.push(i(s.value)),s.added?t.push("</ins>"):s.removed&&t.push("</del>")}return t.join("")},convertChangesToDMP:function(e){for(var t,i=[],n=0;e.length>n;n++)t=e[n],i.push([t.added?1:t.removed?-1:0,t.value]);return i}}}();"undefined"!=typeof module&&(module.exports=JsDiff);