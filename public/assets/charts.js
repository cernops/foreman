function expanded_pie(e,t){$.plot(e,t,{colors:["#4572A7","#AA4643","#89A54E","#80699B","#3D96AE","#DB843D","#92A8CD","#A47D7C","#B5CA92"],series:{pie:{show:!0,labels:{show:!0}}},legend:{show:!1},grid:{clickable:!0}}),e.bind("plotclick",function(e,t,n){search_on_click(e,n)})}function flot_time_chart(e,t,n){var i={series:{stack:e.hasClass("stack")?!0:null,lines:{show:!0,fill:e.hasClass("stack")?.8:!1}},xaxis:{mode:"time",axisLabel:e.data("xaxis-label"),tickLength:0},yaxis:{axisLabel:e.data("yaxis-label"),axisLabelPadding:12,minTickSize:1,tickDecimals:0},selection:{mode:"x"},grid:{hoverable:!0,borderWidth:0},legend:n};$.plot($(e),t,i),bind_hover_event(e,function(e){return"<b>"+e.series.label+":</b> "+e.series.data[e.dataIndex][1]}),e.bind("plotselected",function(t,n){flot_zoom(e,i,n)})}function chart_legend_options(e){if(1==e.data("series").length)return{show:!1};var t=e.data("legend-options");switch(t){case"external":return{show:!0,noColumns:4,container:"#legendContainer",labelFormatter:function(e,t){return'<a rel="twipsy" data-original-title="Details" href="'+t.href+'">'+e+"</a>"}};case"hide":return{show:!1};default:return{show:!0}}}function flot_zoom(e,t,n){1e-5>n.xaxis.to-n.xaxis.from&&(n.xaxis.to=n.xaxis.from+1e-5),1e-5>n.yaxis.to-n.yaxis.from&&(n.yaxis.to=n.yaxis.from+1e-5),plot=$.plot(e,e.data("series"),$.extend(!0,{},t,{xaxis:{min:n.xaxis.from,max:n.xaxis.to},yaxis:{min:n.yaxis.from,max:n.yaxis.to}})),0==e.parents(".stats-well").find(".reset-zoom").size()&&e.parents(".stats-well").prepend("<a class='reset-zoom btn btn-small'>Reset zoom</a>")}function reset_zoom(e){target=$(e).parents(".stats-well").find(".statistics-chart"),target.flot_chart(),$(e).remove()}function showTooltip(e,t,n){var i=n(t);$('<div id="flot-tooltip">'+i+"</div>").css({top:e.pageY-40,left:e.pageX-10,"border-color":t.series.color}).appendTo("body").show()}function bind_hover_event(e,t){$(e).bind("plothover",function(e,n,i){i?$previousPoint!=i.datapoint&&($previousPoint=i.datapoint,$("#flot-tooltip").remove(),showTooltip(n,i,t)):($("#flot-tooltip").remove(),$previousPoint=null)})}function search_on_click(e,t){var n=$(e.currentTarget).data("url");if(void 0!=n){if(-1!=n.indexOf("~VAL2~")){var i=t.series.label.split(" "),a=i[0],o=i[1];n=n.replace("~VAL2~",o)}else{var a=t.series.label;-1!=a.indexOf(" ")&&(a='"'+a+'"')}n=n.replace("~VAL1~",a),e.preventDefault(),window.location.href=n}}function get_pie_chart(e,t){0==$("#"+e).length?($("body").append('<div id="'+e+'" class="modal fade"></div>'),$("#"+e).append('<div class="modal-header"><a href="#" class="close" data-dismiss="modal">&times;</a><h3>Fact Chart</h3></div>').append('<div id="'+e+'-body" class="fact_chart modal-body">Loading ...</div>'),$("#"+e).modal("show"),$.getJSON(t,function(t){var n=$("#"+e+"-body");expanded_pie(n,t.values),n.attr("data-url",foreman_url("/hosts?search=facts."+t.name+"~~VAL1~"))})):$("#"+e).modal("show")}function expand_chart(e){var t=$(e);t.hasClass("statistics-pie")||(t=$(e).parent().find(".statistics-pie"));var n=t.attr("id")+"_modal";if(0==$("#"+n).length){var i=t.clone().empty().attr("id",n+"_chart").removeClass("small");$("body").append('<div id="'+n+'" class="modal fade"></div>'),$("#"+n).append('<div class="modal-header"><a href="#" class="close" data-dismiss="modal">&times;</a><h3> '+t.data("title")+" </h3></div>").append(i),expanded_pie(i,i.data("series"))}$("#"+n).modal("show")}function legend_selected(e){$(e).closest("td").toggleClass("disabled"),$(e).closest("td").next().toggleClass("disabled");var t=$(e).parents(".statistics-chart"),n=t.clone().data("series"),i=t.find(".legend").clone(),a=[];t.find(".legend td.legendLabel:not(.disabled)").each(function(){for(var e=$(this).text(),t=0;n.length>t;t++)if(n[t].label===e)return a.push(n[t]),!0}),flot_time_chart(t,a),t.find(".legend").remove(),t.append(i)}function ext_legend_selected(e){$(e).closest("td").toggleClass("disabled"),$(e).closest("td").next().toggleClass("disabled");var t=$(".statistics-chart"),n=t.clone().data("series"),i=[];$("#legendContainer table td.legendLabel:not(.disabled)").each(function(){for(var e=$(this).text(),t=0;n.length>t;t++)if(n[t].label===e)return i.push(n[t]),!0}),flot_time_chart(t,i,{show:!1})}$.fn.flot_pie=function(){var e=arguments[0]||{};$(this).each(function(t,n){var i=$(n);$.plot(i,i.data("series"),{colors:["#4572A7","#AA4643","#89A54E","#80699B","#3D96AE","#DB843D","#92A8CD","#A47D7C","#B5CA92"],series:{pie:e.pie||{show:!0,radius:1,label:{show:!0,radius:.5,formatter:function(e,t){return'<div class="pie-labels">'+e+"<br/>"+Math.round(t.percent)+"%</div>"},threshold:.1},highlight:{opacity:.1}}},legend:{show:!1},grid:{hoverable:!0,clickable:!0}}),bind_hover_event(i,function(e){var t=Math.round(e.series.percent);return e.series.label+" ("+t+"%)"}),$(i).bind("plotclick",function(e,t,n){search_on_click(e,n)})})},$.fn.flot_bar=function(){arguments[0]||{},$(this).each(function(e,t){var n=$(t);$.plot($(n),[{data:n.data("chart")}],{series:{bars:{show:!0,barWidth:.6,fill:.8},color:"#4572A7"},xaxis:{axisLabel:n.data("xaxis-label"),tickLength:0,ticks:n.data("ticks")},yaxis:{axisLabel:n.data("yaxis-label"),axisLabelPadding:15,minTickSize:1,tickDecimals:0},grid:{hoverable:!0,borderWidth:0},legend:{show:!1}}),bind_hover_event(n,function(e){return"<b>"+n.data("yaxis-label")+":</b> "+e.datapoint[1]})})},$.fn.flot_chart=function(){$(this).each(function(e,t){flot_time_chart($(t),$(t).data("series"),chart_legend_options($(t)))})},$previousPoint=null,$(function(){$(".statistics-pie").flot_pie(),$(".statistics-bar").flot_bar(),$(".statistics-chart").flot_chart(),$(document).on("click",".reset-zoom",function(){reset_zoom(this)}),$(document).on("click",".legend .legendColorBox, .legend .legendLabel",function(){legend_selected(this)}),$(document).on("click","#legendContainer .legendColorBox, .legendContainer .legendLabel",function(){ext_legend_selected(this)})}),$(window).resize(function(){$(".statistics-bar").flot_bar(),$(".statistics-chart").flot_chart()});