function select_first_tab(){$(".lookup-keys-container").each(function(e,t){$(t).find(".smart-var-tabs li").size()>1&&($(t).find(".tab-content .fields").first().addClass("active"),$(t).find(".smart-var-tabs li").first().addClass("active"),$(t).find(".smart-var-tabs li.active").find("a span").show())})}function show_delete_button(e){var t=$(".lookup-keys-container:visible");t.find(".smart-var-tabs li a span:visible").hide(),t.find(".smart-var-tabs li.active").find("a span").show(),$(e).hasClass("label-success")&&t.find(".smart-var-tabs li").size()>1&&select_first_tab()}function remove_node(e){$($(e).parent("a").attr("href")).children(".btn-danger").click();var t=$(".lookup-keys-container:visible"),n=t.find(".smart-var-tabs li a");n.size()>1&&(n.first().parent().addClass("active"),n.first().find("span").show())}function add_child_node(e){var t=$(e).attr("data-association"),n="."+t+"_fields_template",i=$(e).parent().find(n).html();void 0==i&&(i=$(n).html());var a=($(e).closest(".fields").find("input:first").attr("name")||"").replace(new RegExp("[[a-z]+]$"),"");if(a)for(var o=a.match(/[a-z_]+_attributes/g)||[],s=a.match(/(new_)?[0-9]+/g)||[],r=0;o.length>r;r++)s[r]&&(i=i.replace(new RegExp("(_"+o[r]+")_.+?_","g"),"$1_"+s[r]+"_"),i=i.replace(new RegExp("(\\["+o[r]+"\\])\\[.+?\\]","g"),"$1["+s[r]+"]"));var l=new RegExp("new_"+t,"g"),c=(new Date).getTime();i=i.replace(l,"new_"+c);var u="";if("lookup_keys"==t){$("#smart_vars .smart-var-tabs .active, #smart_vars .smart-var-content .active").removeClass("active");var d="<li class='active'><a data-toggle='pill' href='#new_"+c+"' id='pill_new_"+c+"'>new<span class='delete fr'>&times;</span></a></li>";$("#smart_vars .smart-var-tabs").prepend(d),u=$("#smart_vars .smart-var-content").prepend($(i).addClass("active")),$("#smart_vars .smart-var-tabs li.active a").show("highlight",500)}else u=$(i).insertBefore($(e));return $(e).closest("form").trigger({type:"nested:fieldAdded",field:u}),$('a[rel="popover"]').popover(),$('a[rel="twipsy"]').tooltip(),c}function remove_child_node(e){var t=$(e).prev("input[type=hidden]")[0];if(t&&(t.value="1"),$(e).closest(".fields").hide(),$(e).parent().hasClass("fields")){var n=$("#pill_"+$(e).closest(".fields").attr("id")),i=$("<a href='#'>"+n.html()+"</a>").attr("data-pill","#"+n.attr("id"));n.parent().hide(),i.on("click",function(){undo_remove_child_node(this)}),i.find("span").remove(),$(".lookup-keys-container:visible").find(".undo-smart-vars").append(i).show()}return $(e).closest("form").trigger("nested:fieldRemoved"),!1}function undo_remove_child_node(e){var t=$(".lookup-keys-container:visible"),n=t.find($(e).attr("data-pill")),i=t.find(n.attr("href")),a=i.find("input[type=hidden]").first()[0];return a&&(a.value="0"),t.find(".smart-var-tabs li.active").removeClass("active"),t.find(".fields.active").hide().removeClass("active"),i.show().addClass("active"),n.parent().show().addClass("active"),show_delete_button(n),$(e).remove(),0==t.find(".undo-smart-vars a").size()&&t.find(".undo-smart-vars").hide(),!1}function toggleOverrideValue(e){var t=$(e).is(":checked"),n=$(e).closest(".fields"),i=n.find("[id$='_required']"),a=n.find("[id$='_key_type']"),o=n.find("[id$='_validator_type']"),s=n.find("[id$='_default_value']"),r=n.find("[id$='lookup_key_override_value']"),l=$("#pill_"+n.attr("id")+" i");i.attr("disabled",t?null:"disabled"),a.attr("disabled",t?null:"disabled"),o.attr("disabled",t?null:"disabled"),s.attr("disabled",t?null:"disabled"),l.attr("class",t?"icon-flag":"icon- "),r.toggle(t)}function filterByEnvironment(e){if(""==$(e).val())return $("ul.smart-var-tabs li[data-used-environments] a").removeClass("muted"),void 0;var t=$(e).find("option:selected").text();$("ul.smart-var-tabs li[data-used-environments] a").addClass("muted"),$('ul.smart-var-tabs li[data-used-environments*="'+t+'"] a').removeClass("muted")}function filterByClassParam(e){var t=$(e).val().trim();return t.length>0?($("ul.smart-var-tabs li[data-used-environments]").removeClass("search-marker").addClass("hide"),$("ul.smart-var-tabs li[data-used-environments] a[href*="+t+"]:not(.selected-marker)").parent().addClass("search-marker").removeClass("hide")):$("ul.smart-var-tabs li[data-used-environments]:not(.selected-marker)").addClass("search-marker").removeClass("hide"),!1}function validatorTypeSelected(e){var t=$(e).val(),n=$(e).closest(".fields").find("[id$='_validator_rule']");n.attr("disabled",""==t?"disabled":null)}$(function(){$(".smart-var-tabs li a span").hide(),select_first_tab(),$(document).on("click",".smart-var-tabs li a",function(){show_delete_button(this)}),$(document).on("click",".smart-var-tabs li a span",function(){remove_node(this)})});